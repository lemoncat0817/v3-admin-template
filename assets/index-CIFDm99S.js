import{H as f,d as ie,b as ce,r as u,c as me,B as pe,e as i,o as q,f as L,g as a,w as l,h as d,j as y,t as O,l as D,n as ve,F as fe,k as ge,y as F,I as m,p as _e,i as we,_ as be}from"./index-D_ItP8f2.js";const ye=(r,V,_)=>f.get(`/admin/acl/user/${r}/${V}/?username=${_}`),Ve=r=>r.id?f.put("/admin/acl/user/update",r):f.post("/admin/acl/user/save",r),he=r=>f.get("/admin/acl/user/toAssign/"+r),Ce=r=>f.post("/admin/acl/user/doAssignRole",r),ke=r=>f.delete("/admin/acl/user/remove/"+r),Ue=r=>f.delete("/admin/acl/user/batchRemove",{data:r}),xe=()=>f.get("/admin/acl/index/info"),Se=r=>f.get("/admin/acl/user/get/"+r),qe=r=>(_e("data-v-665b4e37"),r=r(),we(),r),Ie={style:{flex:"auto"}},Re=qe(()=>y("h4",null,"分配角色用戶",-1)),ze={style:{flex:"auto"}},Ne=ie({__name:"index",setup(r){const V=ce(),_=u(1),x=u(5),P=u(0),w=u(!1),C=u(!1),I=u(!1),R=u(!0),z=u(!1),T=u([]),b=u(),k=u([]),U=u([]),N=u([]),h=u(""),$=u(""),s=me({username:"",name:"",password:""});pe(()=>{p()});const H={username:[{required:!0,trigger:"blur",validator:(t,e,n)=>{e.trim().length>=3&&e.trim().length<=10?n():n(new Error("用戶名字至少三位,最多十位"))}}],name:[{required:!0,trigger:"blur",validator:(t,e,n)=>{e.trim().length>=5?n():n(new Error("用戶暱稱至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(t,e,n)=>{e.trim().length>=6?n():n(new Error("用戶密碼至少六位"))}}]},p=async()=>{const t=await ye(_.value,x.value,$.value);t.code===200&&(T.value=t.data.records,P.value=t.data.total)},M=()=>{w.value=!0,s.id="",Object.assign(s,{username:"",name:"",password:""}),F(()=>{b.value.clearValidate("username"),b.value.clearValidate("name"),b.value.clearValidate("password")})},G=t=>{w.value=!0,Object.assign(s,t),s.updateTime="",F(()=>{b.value.clearValidate("username"),b.value.clearValidate("name")})},J=t=>{_.value=t,p()},K=t=>{x.value=t,p()},Q=async()=>{if(await b.value.validate(),(await Ve(s)).code===200){if(w.value=!1,m.success(s.id?"修改成功":"添加成功"),(await xe()).code===203){await V.userLogout(),m.warning("登入超時,2秒後跳轉登入頁"),setTimeout(()=>{window.location.reload()},2e3);return}p()}else w.value=!1,m.error(s.id?"修改失敗":"添加失敗")},W=()=>{w.value=!1},X=async t=>{Object.assign(s,t),s.updateTime="";const e=await he(s.id);e.code===200&&(k.value=e.data.allRolesList,U.value=e.data.assignRoles,C.value=!0)},Y=async()=>{const t={userId:s.id,roleIdList:U.value.map(n=>n.id)};(await Ce(t)).code===200&&(C.value=!1,m.success("分配角色成功"),p())},Z=async t=>{if(V.userInfo(),t.username===V.username){m.warning("不能刪除自己");return}(await ke(t.id)).code===200?(m.success("刪除成功"),p()):m.error("刪除失敗")},ee=t=>{N.value=t},ae=async()=>{const t=N.value.map(n=>n.id);z.value=!1;const e=t.map(async n=>{if((await Se(n)).data.username===V.username){m.warning("批量刪除中包含自己，請移除自己再繼續"),z.value=!0;return}});if(await Promise.all(e),!z.value){const n=await Ue(t);n.code===200?(m.success("批量刪除成功"),p()):m.error(`批量刪除失敗因為${n.data}`)}},le=t=>{U.value=t?k.value:[],R.value=!1},te=t=>{const e=t.length;I.value=e===k.value.length,R.value=e>0&&e<k.value.length},oe=()=>{_.value=1,h.value="",$.value="",p()},ne=()=>{$.value=h.value,p(),h.value=""};return(t,e)=>{const n=i("el-input"),g=i("el-form-item"),c=i("el-button"),A=i("el-form"),E=i("el-card"),v=i("el-table-column"),se=i("el-popconfirm"),re=i("el-table"),ue=i("el-pagination"),j=i("el-drawer"),B=i("el-checkbox"),de=i("el-checkbox-group");return q(),L("div",null,[a(E,{style:{height:"80px"}},{default:l(()=>[a(A,{inline:"",class:"form"},{default:l(()=>[a(g,{label:"用戶名:"},{default:l(()=>[a(n,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=o=>h.value=o),placeholder:"請輸入用戶名"},null,8,["modelValue"])]),_:1}),a(g,null,{default:l(()=>[a(c,{type:"primary",disabled:h.value.trim().length===0,onClick:ne},{default:l(()=>[d("搜尋")]),_:1},8,["disabled"]),a(c,{onClick:oe},{default:l(()=>[d("重置")]),_:1})]),_:1})]),_:1})]),_:1}),a(E,{style:{margin:"10px 0px"}},{default:l(()=>[a(c,{type:"primary",onClick:M,icon:"Plus"},{default:l(()=>[d("添加用戶")]),_:1}),a(c,{type:"danger",disabled:N.value.length===0,onClick:ae},{default:l(()=>[d("批量刪除")]),_:1},8,["disabled"]),a(re,{onSelectionChange:ee,style:{margin:"10px 0px"},border:"",data:T.value},{default:l(()=>[a(v,{type:"selection"}),a(v,{label:"#",type:"index",align:"center"}),a(v,{label:"Id",align:"center",prop:"id"}),a(v,{label:"用戶名字",align:"center",prop:"username","show-overflow-tooltip":""}),a(v,{label:"用戶暱稱",align:"center",prop:"name","show-overflow-tooltip":""}),a(v,{label:"用戶角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),a(v,{label:"創建時間",align:"center",prop:"createTime","show-overflow-tooltip":""}),a(v,{label:"更新時間",align:"center",prop:"updateTime","show-overflow-tooltip":""}),a(v,{label:"操作",width:"300px",align:"center"},{default:l(({row:o})=>[a(c,{type:"primary",size:"small",icon:"User",onClick:S=>X(o)},{default:l(()=>[d("分配角色")]),_:2},1032,["onClick"]),a(c,{type:"primary",size:"small",icon:"Edit",onClick:S=>G(o)},{default:l(()=>[d("編輯")]),_:2},1032,["onClick"]),a(se,{width:"260px",title:`你確定要刪除${o.username}嗎?`,onConfirm:S=>Z(o)},{reference:l(()=>[a(c,{type:"primary",size:"small",icon:"Delete"},{default:l(()=>[d("刪除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),a(ue,{"current-page":_.value,"onUpdate:currentPage":e[1]||(e[1]=o=>_.value=o),"page-size":x.value,"onUpdate:pageSize":e[2]||(e[2]=o=>x.value=o),"page-sizes":[5,7,9],background:!0,layout:" prev, pager, next, jumper,->,sizes,total",total:P.value,onCurrentChange:J,onSizeChange:K},null,8,["current-page","page-size","total"])]),_:1}),a(j,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=o=>w.value=o)},{header:l(()=>[y("h4",null,O(s.id?"編輯用戶":"添加用戶"),1)]),default:l(()=>[y("div",null,[a(A,{model:s,rules:H,ref_key:"formRef",ref:b},{default:l(()=>[a(g,{label:"用戶姓名:",prop:"username"},{default:l(()=>[a(n,{placeholder:"請輸入用戶名字",modelValue:s.username,"onUpdate:modelValue":e[3]||(e[3]=o=>s.username=o)},null,8,["modelValue"])]),_:1}),a(g,{label:"用戶暱稱:",prop:"name"},{default:l(()=>[a(n,{placeholder:"請輸入用戶暱稱",modelValue:s.name,"onUpdate:modelValue":e[4]||(e[4]=o=>s.name=o)},null,8,["modelValue"])]),_:1}),s.id?ve("",!0):(q(),D(g,{key:0,label:"用戶密碼:",prop:"password"},{default:l(()=>[a(n,{placeholder:"請輸入用戶密碼",modelValue:s.password,"onUpdate:modelValue":e[5]||(e[5]=o=>s.password=o)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])])]),footer:l(()=>[y("div",Ie,[a(c,{type:"primary",onClick:Q},{default:l(()=>[d("確定")]),_:1}),a(c,{type:"info",onClick:W},{default:l(()=>[d("取消")]),_:1})])]),_:1},8,["modelValue"]),a(j,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=o=>C.value=o)},{header:l(()=>[Re]),default:l(()=>[y("div",null,[a(A,{inline:""},{default:l(()=>[a(g,{label:"用戶姓名"},{default:l(()=>[a(n,{disabled:!0,modelValue:s.username,"onUpdate:modelValue":e[7]||(e[7]=o=>s.username=o)},null,8,["modelValue"])]),_:1}),a(g,{label:"角色列表"},{default:l(()=>[y("div",null,[a(B,{modelValue:I.value,"onUpdate:modelValue":e[8]||(e[8]=o=>I.value=o),indeterminate:R.value,onChange:le},{default:l(()=>[d("全選")]),_:1},8,["modelValue","indeterminate","onChange"]),a(de,{modelValue:U.value,"onUpdate:modelValue":e[9]||(e[9]=o=>U.value=o),onChange:te},{default:l(()=>[(q(!0),L(fe,null,ge(k.value,(o,S)=>(q(),D(B,{key:S,label:o},{default:l(()=>[d(O(o.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange"])])]),_:1})]),_:1})])]),footer:l(()=>[y("div",ze,[a(c,{type:"primary",onClick:Y},{default:l(()=>[d("確定")]),_:1}),a(c,{type:"info",onClick:e[10]||(e[10]=o=>C.value=!1)},{default:l(()=>[d("取消")]),_:1})])]),_:1},8,["modelValue"])])}}}),Ee=be(Ne,[["__scopeId","data-v-665b4e37"]]);export{Ee as default};
