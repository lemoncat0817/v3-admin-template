import{d as $,K,r as N,c as G,x as h,D as H,e as c,o as v,f as V,g as e,w as l,z as x,A as L,j as A,q as Q,h as m,F as R,k as W,l as B,t as D,L as X,I as p,y as S,M as Y,N as Z}from"./index-D_ItP8f2.js";const ee=["onClick"],le=$({__name:"index",setup(te){const s=K(),g=N([]),d=N(0),y=N([]),t=G({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3});h(()=>s.c1Id,()=>{g.value=[],s.c1Id&&b()}),h(()=>s.c3Id,()=>{g.value=[],s.c3Id&&b()});const b=async()=>{const{c1Id:n,c2Id:r,c3Id:_}=s,o=await Z(n,r,_);o.code===200&&(g.value=o.data)},z=()=>{Object.assign(t,{attrName:"",attrValueList:[],categoryId:s.c3Id,categoryLevel:3}),t.id&&delete t.id,d.value=1,t.categoryId=s.c3Id},E=n=>{d.value=1,Object.assign(t,JSON.parse(JSON.stringify(n)))},O=async()=>{(await X(t)).code===200?(b(),d.value=0,p.success(t.id?"修改成功":"添加成功")):p.error(t.id?"修改失败":"添加失败")},k=()=>{d.value=0},U=(n,r)=>{if(n.valueName.trim()===""){t.attrValueList.splice(r,1),p.error("屬性值不能為空");return}t.attrValueList.forEach((_,o)=>{o!==r&&_.valueName===n.valueName&&(t.attrValueList.splice(r,1),p.error("屬性值不能重複"))}),n.flag=!1},q=()=>{t.attrValueList.push({attrId:0,valueName:"",flag:!0}),S(()=>{y.value[y.value.length-1].focus()})},w=(n,r)=>{n.flag=!0,S(()=>{y.value[r].focus()})},j=async n=>{(await Y(n)).code===200?(b(),p.success("刪除成功")):p.error("刪除失敗")};return H(()=>{s.c1Id="",s.c2Id="",s.c3Id=""}),(n,r)=>{const _=c("Category"),o=c("el-button"),u=c("el-table-column"),P=c("el-tag"),F=c("el-popconfirm"),C=c("el-table"),I=c("el-input"),J=c("el-form-item"),M=c("el-form"),T=c("el-card");return v(),V("div",null,[e(_,{scene:d.value},null,8,["scene"]),e(T,{style:{margin:"10px 0px"}},{default:l(()=>[x(A("div",null,[e(o,{onClick:z,type:"primary",icon:"Plus",disabled:!Q(s).c3Id},{default:l(()=>[m("添加屬性")]),_:1},8,["disabled"]),e(C,{border:"",style:{margin:"10px 0px"},data:g.value},{default:l(()=>[e(u,{label:"序號",type:"index",align:"center",width:"80px"}),e(u,{label:"屬性名稱",width:"120px",prop:"attrName"}),e(u,{label:"屬性值"},{default:l(({row:a})=>[(v(!0),V(R,null,W(a.attrValueList,i=>(v(),B(P,{key:i.id},{default:l(()=>[m(D(i.valueName),1)]),_:2},1024))),128))]),_:1}),e(u,{label:"操作",width:"120px"},{default:l(({row:a})=>[e(o,{type:"warning",size:"small",icon:"Edit",onClick:i=>E(a)},null,8,["onClick"]),e(F,{title:`你確定要刪除${a.attrName}嗎?`,onConfirm:i=>j(a.id)},{reference:l(()=>[e(o,{type:"danger",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[L,d.value===0]]),x(A("div",null,[e(M,{inline:""},{default:l(()=>[e(J,{label:"屬性名稱"},{default:l(()=>[e(I,{placeholder:"請輸入屬性名稱",modelValue:t.attrName,"onUpdate:modelValue":r[0]||(r[0]=a=>t.attrName=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(o,{type:"primary",onClick:q,icon:"Plus",disabled:!t.attrName},{default:l(()=>[m("添加屬性值")]),_:1},8,["disabled"]),e(o,{onClick:k},{default:l(()=>[m("取消")]),_:1}),e(C,{border:"",style:{margin:"10px 0px"},data:t.attrValueList},{default:l(()=>[e(u,{type:"index",align:"center",label:"序號",width:"80px"}),e(u,{label:"屬性值"},{default:l(({row:a,$index:i})=>[a.flag?(v(),B(I,{key:0,ref:f=>y.value[i]=f,size:"small",onBlur:f=>U(a,i),placeholder:"請你輸入屬性值名稱",modelValue:a.valueName,"onUpdate:modelValue":f=>a.valueName=f},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(v(),V("div",{key:1,onClick:f=>w(a,i)},D(a.valueName),9,ee))]),_:1}),e(u,{label:" 操作"},{default:l(({$index:a})=>[e(o,{type:"danger",size:"small",icon:"Delete",onClick:i=>t.attrValueList.splice(a,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(o,{type:"primary",onClick:O,disabled:!(t.attrValueList.length>0)},{default:l(()=>[m("保存")]),_:1},8,["disabled"]),e(o,{onClick:k},{default:l(()=>[m("取消")]),_:1})],512),[[L,d.value===1]])]),_:1})])}}});export{le as default};
