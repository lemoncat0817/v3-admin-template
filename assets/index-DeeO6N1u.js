import{H as h,d as Z,r as d,c as ee,B as le,e as i,o as ae,f as oe,g as e,w as a,h as p,j as P,y as q,I as y,p as te,i as ne,_ as re}from"./index-D_ItP8f2.js";const se=(n,u,_)=>h.get(`/admin/acl/role/${n}/${u}/?roleName=${_}`),de=n=>n.id?h.put("/admin/acl/role/update",n):h.post("/admin/acl/role/save",n),ie=n=>h.get("/admin/acl/permission/toAssign/"+n),ue=(n,u)=>h.post(`/admin/acl/permission/doAssign/?roleId=${n}&permissionId=${u}`),ce=n=>h.delete("/admin/acl/role/remove/"+n),pe=n=>(te("data-v-0aee45d9"),n=n(),ne(),n),me=pe(()=>P("h4",null,"分配權限",-1)),fe={style:{flex:"auto"}},ve=Z({__name:"index",setup(n){const u=d(1),_=d(10),C=d(0),V=d([]),m=d(""),N=d(""),f=d(!1),k=d(!1),x=d(),b=d([]),R=d([]),$=d(),r=ee({roleName:""}),v=async()=>{const o=await se(u.value,_.value,m.value);o.code===200&&(V.value=o.data.records,C.value=o.data.total)};le(()=>{v()});const A={roleName:[{required:!0,trigger:"blur",validator:(o,l,s)=>{l.trim().length>=2?s():s(new Error("角色名稱不能為空且不能小於2位"))}}]},E=()=>{r.roleName="",r.id="",q(()=>{x.value.clearValidate("roleName")}),f.value=!0},T=async()=>{await x.value.validate(),(await de(r)).code===200?(y.success(r.id?"更新成功":"添加成功"),f.value=!1,r.id===""&&(u.value=1),v()):(y.error(r.id?"更新失敗":"添加失敗"),f.value=!1)},j=o=>{f.value=!0,Object.assign(r,o),r.updateTime="",q(()=>{x.value.clearValidate("roleName")})},B=o=>{u.value=o,v()},M=o=>{_.value=o,v()},O=()=>{u.value=1,m.value="",N.value="",v()},F=()=>{N.value=m.value,v(),m.value=""},H=async o=>{k.value=!0,Object.assign(r,o);const l=await ie(r.id);l.code===200&&(b.value=l.data,R.value=z(b.value,[]))},L={children:"children",label:"name"},z=(o,l)=>(o.forEach(s=>{s.select&&s.level==4&&l.push(s.id),s.children&&s.children.length>0&&z(s.children,l)}),l),D=async()=>{const o=r.id,l=$.value.getCheckedKeys();(await ue(o,l)).code===200?y.success("分配權限成功"):y.error("分配權限失敗"),k.value=!1},K=async o=>{const l=await ce(o);l.code===200?(y.success("刪除成功"),v()):y.error(`刪除失敗因為${l.data}`)};return(o,l)=>{const s=i("el-input"),w=i("el-form-item"),c=i("el-button"),I=i("el-form"),S=i("el-card"),g=i("el-table-column"),G=i("el-popconfirm"),J=i("el-table"),Q=i("el-pagination"),W=i("el-dialog"),X=i("el-tree"),Y=i("el-drawer");return ae(),oe("div",null,[e(S,{style:{height:"80px"}},{default:a(()=>[e(I,{inline:"",class:"form"},{default:a(()=>[e(w,{label:"角色名稱:"},{default:a(()=>[e(s,{placeholder:"角色名稱",modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=t=>m.value=t)},null,8,["modelValue"])]),_:1}),e(w,null,{default:a(()=>[e(c,{type:"primary",onClick:F,disabled:m.value.length===0},{default:a(()=>[p("搜尋")]),_:1},8,["disabled"]),e(c,{onClick:O},{default:a(()=>[p("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{style:{margin:"10px 0px"}},{default:a(()=>[e(c,{type:"primary",icon:"Plus",onClick:E},{default:a(()=>[p("添加角色")]),_:1}),e(J,{style:{margin:"10px 0px"},border:"",data:V.value},{default:a(()=>[e(g,{width:"200px",label:"#",type:"index",align:"center"}),e(g,{label:"Id",align:"center",prop:"id"}),e(g,{label:"角色名稱",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(g,{label:"創建時間",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(g,{label:"更新時間",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(g,{label:"操作",width:"350px",align:"center"},{default:a(({row:t})=>[e(c,{type:"primary",size:"small",icon:"User",onClick:U=>H(t)},{default:a(()=>[p("分配權限")]),_:2},1032,["onClick"]),e(c,{type:"primary",size:"small",icon:"Edit",onClick:U=>j(t)},{default:a(()=>[p("編輯")]),_:2},1032,["onClick"]),e(G,{width:"260px",onConfirm:U=>K(t.id),title:`你確定要刪除${t.roleName}嗎?`},{reference:a(()=>[e(c,{type:"primary",size:"small",icon:"Delete"},{default:a(()=>[p("刪除")]),_:1})]),_:2},1032,["onConfirm","title"])]),_:1})]),_:1},8,["data"]),e(Q,{"current-page":u.value,"onUpdate:currentPage":l[1]||(l[1]=t=>u.value=t),"page-size":_.value,"onUpdate:pageSize":l[2]||(l[2]=t=>_.value=t),"page-sizes":[10,20,30,40],background:!0,layout:" prev, pager, next, jumper,->,sizes,total",total:C.value,onCurrentChange:B,onSizeChange:M},null,8,["current-page","page-size","total"])]),_:1}),e(W,{modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=t=>f.value=t),title:r.id?"更新角色":"添加角色",width:"500px"},{footer:a(()=>[e(c,{onClick:l[4]||(l[4]=t=>f.value=!1)},{default:a(()=>[p("取消")]),_:1}),e(c,{type:"primary",onClick:T},{default:a(()=>[p("確認")]),_:1})]),default:a(()=>[e(I,{"label-width":"80px",model:r,rules:A,ref_key:"roleForm",ref:x},{default:a(()=>[e(w,{style:{margin:"10px 0px"},label:"角色名稱",prop:"roleName"},{default:a(()=>[e(s,{placeholder:"請填寫角色名稱",modelValue:r.roleName,"onUpdate:modelValue":l[3]||(l[3]=t=>r.roleName=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Y,{modelValue:k.value,"onUpdate:modelValue":l[7]||(l[7]=t=>k.value=t)},{header:a(()=>[me]),default:a(()=>[e(X,{ref_key:"tree",ref:$,data:b.value,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":R.value,props:L},null,8,["data","default-checked-keys"])]),footer:a(()=>[P("div",fe,[e(c,{onClick:l[6]||(l[6]=t=>k.value=!1)},{default:a(()=>[p("取消")]),_:1}),e(c,{type:"primary",onClick:D},{default:a(()=>[p("確認")]),_:1})])]),_:1},8,["modelValue"])])}}}),ye=re(ve,[["__scopeId","data-v-0aee45d9"]]);export{ye as default};
