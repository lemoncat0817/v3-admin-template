import{H as $,d as Z,r as c,O as ie,e as u,o as f,f as L,g as e,w as t,F as R,k as M,j as te,h as T,l as z,I as P,t as ce,y as pe,c as me,N as _e,K as fe,x as ge,D as ve,z as X,A as Y,q as be}from"./index-D_ItP8f2.js";const Se=(g,b,k)=>$.get(`/admin/product/${g}/${b}?category3Id=${k}`),ee=()=>$.get("/admin/product/baseTrademark/getTrademarkList"),ae=g=>$.get("/admin/product/spuImageList/"+g),ne=g=>$.get("/admin/product/spuSaleAttrList/"+g),le=()=>$.get("/admin/product/baseSaleAttrList"),ye=g=>g.id?$.post("/admin/product/updateSpuInfo",g):$.post("/admin/product/saveSpuInfo",g),ke=g=>$.post("/admin/product/saveSkuInfo",g),Ve=g=>$.get("/admin/product/findBySpuId/"+g),Ie=g=>$.delete("/admin/product/deleteSpu/"+g),Ae=["src"],he=Z({__name:"spuForm",emits:["changeScene","changePage"],setup(g,{expose:b,emit:k}){const h=c(""),I=c(!1),C=c([]),V=c([]),S=c([]),s=c(""),D=c([]),q=c([]),_=c({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),w=k,U=()=>{w("changeScene",0)},r=async l=>{_.value=l;const n=await ee();C.value=n.data;const m=await ae(l.id);V.value=m.data.map(K=>({name:K.imgName,url:K.imgUrl}));const x=await ne(l.id);S.value=x.data;const E=await le();D.value=E.data},i=l=>{h.value=l.url,I.value=!0},p=l=>{V.value.forEach((n,m)=>{n.name===l.name&&V.value.splice(m,1)})},A=l=>l.type!=="image/png"&&l.type!=="image/jpeg"&&l.type!=="image/gif"?(P.error("上傳的圖片類型只能是jpeg﹑gif﹑png檔"),!1):l.size/1024/1024>4?(P.error("圖片的檔案大小不能超過 4MB!"),!1):!0,N=ie(()=>D.value.filter(n=>S.value.every(m=>m.saleAttrName!=n.name))),j=()=>{const[l,n]=s.value.split(":"),m={baseSaleAttrId:l,saleAttrName:n,spuSaleAttrValueList:[]};S.value.push(m),s.value=""},B=(l,n)=>{l.flag=!0,l.saleAttrValue="",pe(()=>{q.value[n].focus()})},d=l=>{const{baseSaleAttrId:n,saleAttrValue:m}=l;if(m.trim()==""){P.error("屬性值不能為空"),l.flag=!1;return}if(l.spuSaleAttrValueList.find(E=>E.saleAttrValueName==m)){P.error("屬性值不能重複"),l.flag=!1;return}const x={baseSaleAttrId:n,saleAttrValueName:m};l.spuSaleAttrValueList.push(x),l.flag=!1},v=async()=>{_.value.spuImageList=V.value.map(n=>({imgName:n.name,imgUrl:n.response&&n.response.data||n.url})),_.value.spuSaleAttrList=S.value;const l=await ye(_.value);l.code===200?(P.success(_.value.id?"更新成功":"添加成功"),U(),a()):P.error(_.value.id?`更新失敗因為${l.data}`:`添加失敗因為${l.data}`)},O=async l=>{Object.assign(_.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),_.value.id="",V.value=[],S.value=[],s.value="",_.value.category3Id=l;const n=await ee();C.value=n.data;const m=await le();D.value=m.data},a=()=>{w("changePage",1)};return b({initHasSpuData:r,initAddSpu:O}),(l,n)=>{const m=u("el-input"),x=u("el-form-item"),E=u("el-option"),K=u("el-select"),Q=u("Plus"),y=u("el-icon"),F=u("el-upload"),ue=u("el-dialog"),G=u("el-button"),J=u("el-table-column"),oe=u("el-tag"),se=u("el-table"),de=u("el-form");return f(),L("div",null,[e(de,{"label-width":"100px"},{default:t(()=>[e(x,{label:"SPU名稱"},{default:t(()=>[e(m,{placeholder:"請輸入SPU名稱",modelValue:_.value.spuName,"onUpdate:modelValue":n[0]||(n[0]=o=>_.value.spuName=o)},null,8,["modelValue"])]),_:1}),e(x,{label:"SPU品牌"},{default:t(()=>[e(K,{style:{width:"15%"},placeholder:"請選擇品牌",modelValue:_.value.tmId,"onUpdate:modelValue":n[1]||(n[1]=o=>_.value.tmId=o)},{default:t(()=>[(f(!0),L(R,null,M(C.value,o=>(f(),z(E,{value:o.id,label:o.tmName,key:o.id},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(x,{label:"SPU描述"},{default:t(()=>[e(m,{type:"textarea",placeholder:"請輸入SPU描述",modelValue:_.value.description,"onUpdate:modelValue":n[2]||(n[2]=o=>_.value.description=o)},null,8,["modelValue"])]),_:1}),e(x,{label:"SPU照片"},{default:t(()=>[e(F,{"file-list":V.value,"onUpdate:fileList":n[3]||(n[3]=o=>V.value=o),action:"http://sph-api.atguigu.cn/admin/product/fileUpload","list-type":"picture-card","on-preview":i,"on-remove":p,"before-upload":A},{default:t(()=>[e(y,null,{default:t(()=>[e(Q)]),_:1})]),_:1},8,["file-list"]),e(ue,{modelValue:I.value,"onUpdate:modelValue":n[4]||(n[4]=o=>I.value=o)},{default:t(()=>[te("img",{"w-full":"",src:h.value,alt:"Preview Image"},null,8,Ae)]),_:1},8,["modelValue"])]),_:1}),e(x,{label:"SPU銷售屬性"},{default:t(()=>[e(K,{modelValue:s.value,"onUpdate:modelValue":n[5]||(n[5]=o=>s.value=o),style:{width:"15%"},placeholder:N.value.length?`還未選擇${N.value.length}個`:"無"},{default:t(()=>[(f(!0),L(R,null,M(N.value,o=>(f(),z(E,{label:o.name,value:`${o.id}:${o.name}`,key:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(G,{onClick:j,disabled:!s.value,type:"primary",icon:"Plus",style:{"margin-left":"10px"}},{default:t(()=>[T("添加屬性")]),_:1},8,["disabled"]),e(se,{style:{margin:"10px 0px"},border:"",data:S.value},{default:t(()=>[e(J,{type:"index",label:"序號",width:"80px",align:"center"}),e(J,{label:"屬性名",width:"100px",prop:"saleAttrName"}),e(J,{label:"屬性值"},{default:t(({row:o,$index:W})=>[(f(!0),L(R,null,M(o.spuSaleAttrValueList,(H,re)=>(f(),z(oe,{style:{margin:"0px 5px"},key:H.id,closable:"",onClose:xe=>o.spuSaleAttrValueList.splice(re,1)},{default:t(()=>[T(ce(H.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),o.flag===!0?(f(),z(m,{key:0,ref:H=>q.value[W]=H,onBlur:H=>d(o),modelValue:o.saleAttrValue,"onUpdate:modelValue":H=>o.saleAttrValue=H,placeholder:"請你輸入屬性值",size:"small",style:{width:"100px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(f(),z(G,{key:1,onClick:H=>B(o,W),type:"success",size:"small",icon:"Plus"},null,8,["onClick"]))]),_:1}),e(J,{label:"操作",width:"100px"},{default:t(({$index:o})=>[e(G,{type:"danger",size:"small",icon:"Delete",onClick:W=>S.value.splice(o,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(G,{disabled:!(S.value.length>0),type:"primary",onClick:v},{default:t(()=>[T("保存")]),_:1},8,["disabled"]),e(G,{type:"info",onClick:U},{default:t(()=>[T("取消")]),_:1})]),_:1})]),_:1})])}}}),Ue=Z({__name:"skuForm",emits:["changeScene"],setup(g,{expose:b,emit:k}){const h=k,I=c([]),C=c([]),V=c([]),S=c(),s=me({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),D=async()=>{s.skuAttrValueList=I.value.reduce((r,i)=>{if(i.attrIdAndValueId){const[p,A]=i.attrIdAndValueId.split(":");r.push({attrId:p,valueId:A})}return r},[]),s.skuSaleAttrValueList=C.value.reduce((r,i)=>{if(i.saleIdAndValueId){const[p,A]=i.saleIdAndValueId.split(":");r.push({saleAttrId:p,saleAttrValueId:A})}return r},[]),(await ke(s)).code===200?(P.success("添加sku成功"),h("changeScene",0)):P.error("添加sku失败")},q=()=>{h("changeScene",0)},_=U=>{V.value.forEach(r=>{S.value.toggleRowSelection(r,!1)}),S.value.toggleRowSelection(U,!0),s.skuDefaultImg=U.imgUrl};return b({initSkuData:async(U,r,i)=>{s.category3Id=i.category3Id,s.spuId=i.id,s.tmId=i.tmId;const p=await _e(U,r,i.category3Id);I.value=p.data;const A=await ne(i.id);C.value=A.data;const N=await ae(i.id);V.value=N.data}}),(U,r)=>{const i=u("el-input"),p=u("el-form-item"),A=u("el-option"),N=u("el-select"),j=u("el-form"),B=u("el-table-column"),d=u("el-image"),v=u("el-button"),O=u("el-table");return f(),L("div",null,[e(j,{"label-width":"100px"},{default:t(()=>[e(p,{label:"sku名稱"},{default:t(()=>[e(i,{placeholder:"sku名稱",modelValue:s.skuName,"onUpdate:modelValue":r[0]||(r[0]=a=>s.skuName=a)},null,8,["modelValue"])]),_:1}),e(p,{label:"價格(元)"},{default:t(()=>[e(i,{placeholder:"價格(元)",type:"number",modelValue:s.price,"onUpdate:modelValue":r[1]||(r[1]=a=>s.price=a)},null,8,["modelValue"])]),_:1}),e(p,{label:"重量(克)"},{default:t(()=>[e(i,{placeholder:"重量(克)",type:"number",modelValue:s.weight,"onUpdate:modelValue":r[2]||(r[2]=a=>s.weight=a)},null,8,["modelValue"])]),_:1}),e(p,{label:"sku描述"},{default:t(()=>[e(i,{placeholder:"sku描述",type:"textarea",modelValue:s.skuDesc,"onUpdate:modelValue":r[3]||(r[3]=a=>s.skuDesc=a)},null,8,["modelValue"])]),_:1}),e(p,{label:"平台屬性"},{default:t(()=>[e(j,{inline:"","label-width":"100px"},{default:t(()=>[(f(!0),L(R,null,M(I.value,a=>(f(),z(p,{key:a.id,label:a.attrName},{default:t(()=>[e(N,{style:{width:"230px"},modelValue:a.attrIdAndValueId,"onUpdate:modelValue":l=>a.attrIdAndValueId=l},{default:t(()=>[(f(!0),L(R,null,M(a.attrValueList,l=>(f(),z(A,{key:l.id,label:l.valueName,value:`${a.id}:${l.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(p,{label:"銷售屬性"},{default:t(()=>[e(j,{inline:"","label-width":"100px"},{default:t(()=>[(f(!0),L(R,null,M(C.value,a=>(f(),z(p,{key:a.id,label:a.saleAttrName},{default:t(()=>[e(N,{style:{width:"230px"},modelValue:a.saleIdAndValueId,"onUpdate:modelValue":l=>a.saleIdAndValueId=l},{default:t(()=>[(f(!0),L(R,null,M(a.spuSaleAttrValueList,l=>(f(),z(A,{key:l.id,label:l.saleAttrValueName,value:`${a.id}:${l.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(p,{label:"圖片名稱"},{default:t(()=>[e(O,{border:"",data:V.value,ref_key:"table",ref:S},{default:t(()=>[e(B,{type:"selection",width:"80px",align:"center"}),e(B,{label:"圖片"},{default:t(({row:a})=>[e(d,{src:a.imgUrl,style:{width:"100px",height:"100px"}},null,8,["src"])]),_:1}),e(B,{label:"名稱",prop:"imgName"}),e(B,{label:"操作"},{default:t(({row:a})=>[e(v,{type:"primary",size:"small",onClick:l=>_(a)},{default:t(()=>[T("設置默認")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(p,null,{default:t(()=>[e(v,{type:"primary",onClick:D},{default:t(()=>[T("保存")]),_:1}),e(v,{type:"info",onClick:q},{default:t(()=>[T("取消")]),_:1})]),_:1})]),_:1})])}}}),we=Z({__name:"index",setup(g){const b=fe(),k=c(0),h=c(1),I=c(5),C=c(0),V=c([]),S=c(),s=c(),D=c([]),q=c(!1);ge(()=>b.c3Id,()=>{b.c3Id&&w()});const _=()=>{k.value=1,S.value.initAddSpu(b.c3Id)},w=async()=>{const d=await Se(h.value,I.value,b.c3Id);d.code===200&&(C.value=d.data.total,V.value=d.data.records)},U=d=>{I.value=d,b.c3Id&&w()},r=d=>{h.value=d,w()},i=d=>{k.value=d,d===0&&w()},p=d=>{h.value=d,w()},A=d=>{k.value=1,S.value.initHasSpuData(d)},N=d=>{k.value=2,s.value.initSkuData(b.c1Id,b.c2Id,d)},j=async d=>{const v=await Ve(d.id);v.code===200&&(D.value=v.data,q.value=!0)},B=async d=>{const v=await Ie(d.id);v.code===200?(P.success("刪除成功"),w()):P.error(`刪除失敗因為${v.data}`)};return ve(()=>{b.c1Id="",b.c2Id="",b.c3Id=""}),(d,v)=>{const O=u("Category"),a=u("el-button"),l=u("el-table-column"),n=u("el-popconfirm"),m=u("el-table"),x=u("el-pagination"),E=u("el-image"),K=u("el-dialog"),Q=u("el-card");return f(),L("div",null,[e(O,{scene:k.value},null,8,["scene"]),e(Q,{style:{margin:"10px 0px"}},{default:t(()=>[X(te("div",null,[e(a,{type:"primary",icon:"Plus",style:{margin:"10px 0px"},disabled:!be(b).c3Id,onClick:_},{default:t(()=>[T("添加SPU")]),_:1},8,["disabled"]),e(m,{style:{width:"100%"},border:"",data:V.value},{default:t(()=>[e(l,{type:"index",label:"序號",width:"80px",align:"center"}),e(l,{prop:"spuName",label:"SPU名稱"}),e(l,{prop:"description",label:"SPU描述","show-overflow-tooltip":""}),e(l,{label:"SPU操作"},{default:t(({row:y})=>[e(a,{type:"primary",icon:"Plus",size:"small",title:"添加SKU",onClick:F=>N(y)},null,8,["onClick"]),e(a,{type:"warning",icon:"Edit",size:"small",title:"修改SPU",onClick:F=>A(y)},null,8,["onClick"]),e(a,{type:"info",icon:"InfoFilled",size:"small",title:"查看SKU列表",onClick:F=>j(y)},null,8,["onClick"]),e(n,{title:`你要刪除${y.spuName}?`,width:"200px",onConfirm:F=>B(y)},{reference:t(()=>[e(a,{type:"danger",icon:"Delete",size:"small",title:"刪除SPU列表"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(x,{"current-page":h.value,"onUpdate:currentPage":v[0]||(v[0]=y=>h.value=y),"page-size":I.value,"onUpdate:pageSize":v[1]||(v[1]=y=>I.value=y),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:C.value,onSizeChange:U,onCurrentChange:r},null,8,["current-page","page-size","total"])],512),[[Y,k.value===0]]),X(e(he,{ref_key:"spu",ref:S,onChangeScene:i,onChangePage:p},null,512),[[Y,k.value===1]]),X(e(Ue,{ref_key:"sku",ref:s,onChangeScene:i},null,512),[[Y,k.value===2]]),e(K,{modelValue:q.value,"onUpdate:modelValue":v[2]||(v[2]=y=>q.value=y),title:"SKU列表"},{default:t(()=>[e(m,{data:D.value,border:""},{default:t(()=>[e(l,{label:"sku名字",prop:"skuName"}),e(l,{label:"sku價格",prop:"price"}),e(l,{label:"sku重量",prop:"weight"}),e(l,{label:"sku圖片"},{default:t(({row:y})=>[e(E,{style:{width:"100px",height:"100px"},src:y.skuDefaultImg},null,8,["src"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{we as default};
